<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirma√ß√µes de Presen√ßa - Casamento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Freight Big Pro", serif;
            background-color: rgb(255, 255, 255);
            background-image: url('Convite_Casamento.svg?v=2024');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
            padding: 2rem;
            position: relative;
        }

        html {
            background-color: rgb(255, 255, 255);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: rgba(255, 255, 255, 0.8);
            color: #333333;
            padding: 2rem;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 1.1rem;
            color: #666666;
            font-family: "Snell Roundhand", cursive;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 2rem;
            background: rgba(248, 249, 250, 0.6);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.8);
            padding: 1.5rem;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .confirmados .stat-number { color: #28a745; }
        .nao-podem .stat-number { color: #dc3545; }
        .pendentes .stat-number { color: #ffc107; }
        .total .stat-number { color: #007bff; }
        
        /* Estilo para o card de total de convidados */
        .stat-card:last-child .stat-number { 
            color: #6f42c1; 
            background: linear-gradient(135deg, #6f42c1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tables-container {
            padding: 2rem;
        }

        .table-section {
            margin-bottom: 3rem;
        }

        .table-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #eee;
        }

        .confirmados .table-title { border-color: #28a745; color: #28a745; }
        .nao-podem .table-title { border-color: #dc3545; color: #dc3545; }
        .pendentes .table-title { border-color: #ffc107; color: #ffc107; }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(238, 238, 238, 0.5);
        }

        .table th {
            background: rgba(248, 249, 250, 0.8);
            font-weight: 600;
            color: #333;
        }

        .table tr:hover {
            background: rgba(248, 249, 250, 0.6);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-confirmado {
            background: #d4edda;
            color: #155724;
        }

        .status-nao-pode {
            background: #f8d7da;
            color: #721c24;
        }

        .status-pendente {
            background: #fff3cd;
            color: #856404;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-style: italic;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
                padding: 1rem;
            }

            .tables-container {
                padding: 1rem;
            }

            .table {
                font-size: 0.9rem;
            }

            .table th,
            .table td {
                padding: 0.75rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Confirma√ß√µes de Presen√ßa</h1>
            <p>Painel administrativo - Casamento</p>
        </div>

        <div class="stats">
            <div class="stat-card confirmados">
                <div class="stat-number" id="confirmados-count">-</div>
                <div class="stat-label">Confirmados</div>
            </div>
            <div class="stat-card nao-podem">
                <div class="stat-number" id="nao-podem-count">-</div>
                <div class="stat-label">N√£o Podem Ir</div>
            </div>
            <div class="stat-card pendentes">
                <div class="stat-number" id="pendentes-count">-</div>
                <div class="stat-label">Pendentes</div>
            </div>
            <div class="stat-card total">
                <div class="stat-number" id="total-count">-</div>
                <div class="stat-label">Total Respostas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-convidados-count">-</div>
                <div class="stat-label">Total Convidados</div>
            </div>
        </div>

        <div class="tables-container">
            <div class="loading" id="loading">
                <p>Carregando dados...</p>
            </div>

            <div class="table-section confirmados" id="confirmados-section" style="display: none;">
                <h2 class="table-title">Confirmados </h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Data de Confirma√ß√£o</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="confirmados-tbody">
                    </tbody>
                </table>
            </div>

            <div class="table-section nao-podem" id="nao-podem-section" style="display: none;">
                <h2 class="table-title">N√£o Podem Comparecer</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Data de Resposta</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="nao-podem-tbody">
                    </tbody>
                </table>
            </div>

            <div class="table-section pendentes" id="pendentes-section" style="display: none;">
                <h2 class="table-title">Aguardando Confirma√ß√£o</h2>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="pendentes-tbody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Lista de nomes convidados (mesma do index.html)
        const listaNomes = [
            // Esp√≠rito Santo
            'Wesley Bertoli', 'Leila Venturini', 'Nathiely Bertoli', 'Nathan Bertoli', 'Camila Magnago', 'Edjane Bertoli', 'Cilas Sepulchro', 'Jo√£o Lucas Bertoli',
            'Kamily Castro', 'Jo√£o Marcos Bertoli', 'Welligton Bertoli', 'Alice Goldner', 'Maria Eloisa Goldner', 'Korrinna Bertoli', 'Penha Caliari',
            'Narciso Bertoli', 'Anatilde', 'Jos√© Caliari', 'Dheyner Bertoli', 'Ricardo', 'Rodrigo Bertoli', 'Ana Julia Flores',
            'Thauana Bertoli', 'Bruna', 'Zezim', 'Sandra', 'Juraci', 'Servolo', 'Charles', 'Sueli De Souza',
            'Eduardo Scardua', 'Lisley Bertoli', 'Silvio De Souza', 'Simone Gempka', 'Bryan Gempka', 'Kethelyn Gempka',
            'Leandro De Souza', 'Nilza', 'Hulyana', 'Leonardo', 'Jo√£o Victor', 'Ana Claudia', 'Ilza De Souza', 'Luca Lonardi', 'La√≠ssa Soares', 'Luiz De Souza', 'Maria Clara', 'Cinthia De Souza',
            
            // Goi√¢nia
            'Helena Nunes', 'Ant√¥nio Nunes', 'Milene Nunes', 'Eduarda Zabelly Nunes', 'Marcos Nunes', 'Liciene Rodrigues', 'Dudu Nunes',
            'Douglas Nunes', 'Lucas Nunes', 'Vilma Rodrigues', 'Marisa Nunes', 'Carlos Araujo', 'Alexya', 'Carol',
            'Neison', 'Moises', 'Simon', 'Benedito', 'Ilza Nunes', 'Breno Nunes', 'Rabeche',
            'Maria Julia', 'Augusto', 'Italo', 'Delandia', 'Nazar√©', 'Gabriel Nunes',
            'Mariana', 'Belchior', 'Dark', 'Giovana Nunes', 'Wallace Nunes', 'Monique', 'Lucia Nunes',
            'Juliana', 'Leo', 'Davi', 'Gislaine', 'Israel', 'Giovana',
            'Fernanda', 'Junim', 'Marcelo', 'Vitoria', 'Jose Henrique', 'Jose Eloi',
            'Beni', 'Renata', 'Guilherme Soares', 'Luiz Neto', 'Jose Junior', 'Janaina', 'Beatriz', 'Davi Eloi', 'Ant√¥nio Filho', 'Thalys', 'Abio', 'Ayte', 'Abadia', 'Ilda', 'Fatima', 'Selma', 'Regina', 'Cleyton', 'Wivian', 'Caio', 'Manuela', 'Wellington Nunes', 'Ana Julia Soares','Ana Julya Alves', 'Guilherme Santos', 'Emanuelly Nunes', 'Marina Machado', 'Luiz Paula', 'Neia','Osman', 'Isac', 'Rafaela', 'Samylla'
        ];
        
        // Firebase configuration - mesma da p√°gina principal
        const firebaseConfig = {
            apiKey: "AIzaSyDW-QYTaP3YKyTT6xoufmSqmurCXlnuZDU",
            authDomain: "tripfy-9f09b.firebaseapp.com",
            projectId: "tripfy-9f09b",
            storageBucket: "tripfy-9f09b.firebasestorage.app",
            messagingSenderId: "789407223851",
            appId: "1:789407223851:web:7bfb1996e8a62c4e7dda6e",
            measurementId: "G-3RX0B0B1SV"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Fun√ß√£o para formatar data
        function formatarData(dataString) {
            if (!dataString) return '-';
            const data = new Date(dataString);
            return data.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Fun√ß√£o para carregar dados do Firebase ou usar dados de exemplo
         async function carregarDados(usarExemplo = false) {
             try {
                 document.getElementById('loading').style.display = 'block';
                 let dados = [];
                
                if (usarExemplo) {
                    // Usar dados de exemplo
                    dados = dadosExemplo;
                    console.log('üìã Usando dados de exemplo:', dados);
                } else {
                    // Tentar carregar do Firebase
                    const querySnapshot = await getDocs(collection(db, 'rsvp'));
                    
                    querySnapshot.forEach((doc) => {
                        dados.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    console.log('üìä Dados carregados do Firebase:', dados);
                }

                // Categorizar dados
                const confirmados = dados.filter(item => item.resposta === 'confirmado');
                const recusados = dados.filter(item => item.resposta === 'declinado' || item.resposta === 'recusado' || item.resposta === 'nao_pode');
                const pendentes = listaNomes.filter(nome => 
                    !dados.some(item => item.nome === nome.toLowerCase().trim())
                ).map(nome => ({ nome: nome, resposta: 'pendente' }));
                
                console.log('‚úÖ Confirmados:', confirmados);
                console.log('‚ùå Recusados/Declinados:', recusados);
                console.log('‚è≥ Pendentes:', pendentes.length, 'pessoas');

                // Atualizar contadores
                document.getElementById('confirmados-count').textContent = confirmados.length;
                document.getElementById('nao-podem-count').textContent = recusados.length;
                document.getElementById('pendentes-count').textContent = pendentes.length;
                document.getElementById('total-count').textContent = confirmados.length + recusados.length;
                document.getElementById('total-convidados-count').textContent = listaNomes.length;

                // Preencher tabelas
                preencherTabela('confirmados-tbody', confirmados, 'confirmado');
                preencherTabela('nao-podem-tbody', recusados, 'nao_pode');
                preencherTabelaPendentes('pendentes-tbody', pendentes);

                // Mostrar se√ß√µes
                document.getElementById('loading').style.display = 'none';
                if (confirmados.length > 0) {
                    document.getElementById('confirmados-section').style.display = 'block';
                }
                if (recusados.length > 0) {
                    document.getElementById('nao-podem-section').style.display = 'block';
                }
                if (pendentes.length > 0) {
                    document.getElementById('pendentes-section').style.display = 'block';
                }

            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                console.log('üîÑ Tentando usar dados de exemplo...');
                
                // Se falhar, usar dados de exemplo
                if (!usarExemplo) {
                    carregarDados(true);
                } else {
                    document.getElementById('loading').innerHTML = '<p style="color: #dc3545;">‚ùå Erro ao carregar dados.</p>';
                }
            }
        }

        // Fun√ß√£o para capitalizar primeira letra de cada palavra
        function capitalizarNome(nome) {
            if (!nome) return nome;
            return nome.split(' ').map(palavra => 
                palavra.charAt(0).toUpperCase() + palavra.slice(1).toLowerCase()
            ).join(' ');
        }

        // Fun√ß√£o para preencher tabela com confirma√ß√µes
        function preencherTabela(tbodyId, dados, tipoStatus) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';

            if (dados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="empty-state">Nenhum registro encontrado</td></tr>';
                return;
            }

            // Ordenar por nome em ordem alfab√©tica
            dados.sort((a, b) => {
                const nomeA = (a.nome || a.id).toLowerCase();
                const nomeB = (b.nome || b.id).toLowerCase();
                return nomeA.localeCompare(nomeB);
            });

            dados.forEach(item => {
                const row = document.createElement('tr');
                const statusClass = tipoStatus === 'confirmado' ? 'status-confirmado' : 'status-nao-pode';
                const statusText = tipoStatus === 'confirmado' ? 'Confirmado' : 'N√£o Pode Ir';
                const nomeFormatado = capitalizarNome(item.nome || item.id);
                
                row.innerHTML = `
                    <td>${nomeFormatado}</td>
                    <td>${formatarData(item.dataResposta)}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Fun√ß√£o para preencher tabela de pendentes
        function preencherTabelaPendentes(tbodyId, dados) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';

            if (dados.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2" class="empty-state">Nenhum registro encontrado</td></tr>';
                return;
            }

            // Ordenar por nome em ordem alfab√©tica
            dados.sort((a, b) => {
                const nomeA = (a.nome || a.id).toLowerCase();
                const nomeB = (b.nome || b.id).toLowerCase();
                return nomeA.localeCompare(nomeB);
            });

            dados.forEach(item => {
                const row = document.createElement('tr');
                const nomeFormatado = capitalizarNome(item.nome || item.id);
                row.innerHTML = `
                    <td>${nomeFormatado}</td>
                    <td><span class="status-badge status-pendente">Pendente</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Dados de exemplo para demonstra√ß√£o
        const dadosExemplo = [
            { nome: 'Maria Silva', resposta: 'confirmado', dataResposta: '2024-12-15T10:30:00Z', ip: '192.168.1.1' },
            { nome: 'Jo√£o Santos', resposta: 'confirmado', dataResposta: '2024-12-14T15:45:00Z', ip: '192.168.1.2' },
            { nome: 'Ana Costa', resposta: 'confirmado', dataResposta: '2024-12-13T09:20:00Z', ip: '192.168.1.3' },
            { nome: 'Pedro Oliveira', resposta: 'declinado', dataResposta: '2024-12-12T14:10:00Z', ip: '192.168.1.4' },
            { nome: 'Carla Mendes', resposta: 'confirmado', dataResposta: '2024-12-11T16:55:00Z', ip: '192.168.1.5' },
            { nome: 'Lucas Ferreira', resposta: 'declinado', dataResposta: '2024-12-10T11:30:00Z', ip: '192.168.1.6' },
            { nome: 'Rafael Silva', resposta: 'recusado', dataResposta: '2024-12-09T13:25:00Z', ip: '192.168.1.7' }
        ];



        // Fun√ß√£o para testar conex√£o e usar dados de exemplo se necess√°rio
        async function testarConexao() {
            try {
                console.log('üî• Testando conex√£o com Firebase...');
                
                // Tentar buscar dados primeiro
                const querySnapshot = await getDocs(collection(db, 'rsvp'));
                console.log('‚úÖ Conex√£o com Firebase estabelecida!');
                console.log('üìä Documentos encontrados:', querySnapshot.size);
                
                if (querySnapshot.size === 0) {
                    console.log('‚ÑπÔ∏è Nenhum dado encontrado no Firebase. Usando dados de exemplo.');
                    return 'exemplo';
                }
                
                return true;
            } catch (error) {
                console.error('‚ùå Erro na conex√£o com Firebase:', error);
                console.log('üîÑ Usando dados de exemplo para demonstra√ß√£o.');
                return 'exemplo';
            }
        }

        // Carregar dados ao inicializar
        testarConexao().then(conectado => {
            if (conectado === true) {
                carregarDados();
                // Atualizar dados a cada 30 segundos
                setInterval(carregarDados, 30000);
            } else if (conectado === 'exemplo') {
                carregarDados(true);
            }
        });
    </script>
</body>
</html>